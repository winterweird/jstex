# JSTex - a LaTeX math symbols to unicode engine

## What is it?

Essentially it's a replacement engine that maps substrings such as `\pi` or
`\cdot` (that is, LaTeX math symbols) into the corresponding Unicode characters
for use in a web browser.

A working demonstrator can be found [here](https://vegarditland.com/jstex).

## Example usage

```html
<!-- In body: -->
<script type="text/javascript" src="texmath.js"></script>
<script type="text/javascript" src="jstex.js"></script>
<script type="text/javascript">
let x = "string containing LaTeX math symbols such as \\Sigma or \\varepsilon";
let output = jstex(x);

let s = document.createElement("span");
s.appendChild(document.createTextNode(output));
document.body.appendChild(s);
// appends a span with innerHTML "string containing LaTeX math symbols such as Σ or ε"
</script>
```

This is built to work with a browser, but could also be adapted for use with
NodeJS.

## How does it work?

The file `texmath.js` contains the variable `mapsym` which returns a map from
LaTeX math symbol codes (such as `"pi"`) to the corresponding unicode character
(such as `"\u{003C0}"`). The file `jstex.js` contains a function `jstex(text)`
which takes a regex selecting any of the keys `k` in `mapsym` and replaces the
occurrences of `\k` in `text` with the corresponding unicode character `mapsym[k]`.
In order to ensure that the longest possible substring is always matched, keys
are sorted by length before the regex is constructed.

This isn't specific to the math symbols in LaTeX - the only thing which is LaTeX
specific is the preceding backslash - but with a different `mapsym` it could
replace any argumentless LaTeX command with the corresponding unicode character.

The mapping was extracted from https://github.com/wspr/unicode-math/blob/master/unicode-math-table.tex
using the following regex:

```bash
grep unicode-math-table.tex -e UnicodeMathSymbol | sed -n 's/\\UnicodeMathSymbol{"\(.....\)}{\\\(mup\)\?\([^ ]*\).*/"\3" : "\\u{\1}",/p' > texmath.js
```

Notice the `\(mup\)\?` part of the `sed` expression, which removes the preceding
"mup" in front of the Greek letters so that the familiar LaTeX math commands can
be used.

For convenience, `jstex.js` also contains regexes `regtexc` and `regtexnc`,
which are regexes that match any LaTeX command, but either capture or do not
capture the command, respectively.

## Italicization

The following function may be helpful if you wish to give sections of the text a
similar styling from what you get using LaTeX's `$` math section:

```js
function italicize_latex(text) {
    let concat = (acc, x) => acc+x;
    let inMathSection = false;
    return text.split('$').map(xs => {
        if (inMathSection) {
            let backslash = false;
            xs = xs.split(regtexc).map(x => {
                if (!backslash) {
                    x = x.split('')
                         .map(ch => mapsym.hasOwnProperty('mit'+ch) ? ' \\mit'+ ch + ' ' : ch)
                         .reduce(concat, '');
                }
                else {
                    x = '\\' + x; // reinsert backslash
                }
                backslash = !backslash;
                return x;
            }).reduce(concat, '');
        }
        inMathSection = !inMathSection;
        return xs;
    }).reduce(concat, '');
}
```

This function will, for all sections enclosed in `$` signs, replace all
characters which have an italic version with the LaTeX command for the italic
version of that character if they are not part of something already recognized
as a LaTeX command. It will also pad such characters with surrounding spaces,
which in HTML will be compressed down to a single visible space, giving it a
slightly more spaced-out look than it would otherwise get.

Due to `mith` not existing in the list of LaTeX math symbols, [the Unicode code
point for the Planck constant](http://www.fileformat.info/info/unicode/char/210E/index.htm) was added instead.

## Limitations

Currently there is no way to support commands which take arguments - for
instance, it's not possible to make text bold by using the `\mathbf{...}`
command. The HTML output also is not as pretty as the output generated by
tools like `pdflatex`, but I'll let web browsers take part of the blame for
that.
